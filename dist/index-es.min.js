function addResource({before:e,after:r,element:t,listen:o,remove:n,acceptErrors:a,stylesheetURL:s}){let c;return o&&(c=new Promise((e,r)=>{a&&(r="function"==typeof a?t=>{a({error:t,resolve:e,reject:r,stylesheetURL:s})}:e);const o=()=>{t.removeEventListener("error",c),t.removeEventListener("load",l),n&&t.remove()},c=e=>{r(e),o()},l=()=>{e(t),o()};t.addEventListener("error",c),t.addEventListener("load",l)})),e?e.before(t):r?r.after(t):document.head.append(t),c}const loadResources=async function(e,{autoDetectType:r=!1,before:t=null,after:o=null,remove:n=!1,favicon:a=!1,canvas:s=!1,image:c=!0,acceptErrors:l=!1,link:i=!1}={}){e=Array.isArray(e)?e:[e];const f=await Promise.all(e.map(async e=>{let f={};if(Array.isArray(e))[e,f={}]=e;else if(e&&"object"==typeof e){if(e.then)return e;({url:e,options:f={}}=e)}const{before:m=t,after:d=o,remove:u=n,canvas:v=s,image:p=c,acceptErrors:y=l,favicon:h=a,link:E=i,autoDetectType:b=r}=f;if(h||E)return{results:loadExternals(e,{before:m,after:d,remove:u,favicon:h,canvas:v,image:p,acceptErrors:y})};const R=await fetch(e);return Promise.all([b?R.clone().text():R.text(),b?R.blob().then(e=>e.type.includes("text/css")):e.endsWith(".css"),m,d,u,y])}));return Promise.all(f.map(e=>{if(!Array.isArray(e))return e.results?e.results.then(e=>e[0]):e;const[r,t,o,n,a,s]=e,c=t?"style":"script",l=document.createElement(c);return l.append(r),addResource({before:o,after:n,remove:a,element:l,listen:!0,acceptErrors:s})}))},loadExternals=function(e,{before:r=null,after:t=null,remove:o=!1,favicon:n=!1,canvas:a=!1,image:s=!0,acceptErrors:c=!1}={}){return e=Array.isArray(e)?e:[e],Promise.all(e.map(function(e){let l={};Array.isArray(e)?[e,l={}]=e:e&&"object"==typeof e&&({stylesheetURL:e=e.stylesheet,options:l={}}=e);let{favicon:i=n}=l;const{before:f=r,after:m=t,remove:d=o,canvas:u=a,image:v=s,acceptErrors:p=c}=l,y=document.createElement("link");return e.endsWith(".css")?i=!1:e.endsWith(".ico")&&(i=!0),i?(y.rel="shortcut icon",y.type="image/x-icon",new Promise((r,t)=>{if(p&&(t="function"==typeof p?o=>{p({error:o,stylesheetURL:e,options:l,resolve:r,reject:t})}:r),!1===v)return y.href=e,addResource({before:f,after:m,remove:d,element:y}),void r(y);const o=document.createElement("canvas");o.width=16,o.height=16;const n=o.getContext("2d"),a=document.createElement("img");a.addEventListener("error",e=>{t(e)}),a.addEventListener("load",()=>{n.drawImage(a,0,0),y.href=u?o.toDataURL("image/x-icon"):e,addResource({before:f,after:m,remove:d,element:y}),r(y)}),a.src=e})):(y.rel="stylesheet",y.type="text/css",y.href=e,addResource({before:f,after:m,remove:d,element:y,acceptErrors:p,listen:!0,stylesheetURL:e}))}))};export{loadResources,loadExternals};
//# sourceMappingURL=index-es.min.js.map
