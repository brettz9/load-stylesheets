{"version":3,"file":"index-umd.min.cjs","sources":["../src/index.js"],"sourcesContent":["/**\n * @typedef {{\n *   before?: HTMLElement,\n *   after?: HTMLElement,\n *   favicon?: boolean,\n *   image?: boolean,\n *   canvas?: boolean,\n * }} Options\n */\n\n/**\n * @typedef {string|\n *   (string|[stylesheetURL: string, options: Options])[]} Stylesheets\n */\n/**\n * @param {Stylesheets} stylesheets\n * @param {{\n *   before?: HTMLElement,\n *   after?: HTMLElement,\n *   favicon?: boolean,\n *   image?: boolean,\n *   canvas?: boolean,\n *   acceptErrors?: boolean|((info: {\n *     error: ErrorEvent,\n *     stylesheetURL: string,\n *     options: {},\n *     resolve: (value: any) => void,\n *     reject: (reason?: any) => void\n *   }) => (reason?: any) => void)\n * }} cfg\n * @returns {Promise<HTMLLinkElement[]>}\n */\nexport default function loadStylesheets (stylesheets, {\n  before: beforeDefault, after: afterDefault, favicon: faviconDefault,\n  canvas: canvasDefault, image: imageDefault = true,\n  acceptErrors\n} = {}) {\n  stylesheets = Array.isArray(stylesheets) ? stylesheets : [stylesheets];\n\n  /**\n   * @param {string|[stylesheetURL: string, options: Options]} stylesheetURLInfo\n   * @returns {Promise<HTMLLinkElement>}\n   */\n  function setupLink (stylesheetURLInfo) {\n    /** @type {Options} */\n    let options = {};\n\n    /** @type {string} */\n    let stylesheetURL;\n    if (Array.isArray(stylesheetURLInfo)) {\n      ([stylesheetURL, options = {}] = stylesheetURLInfo);\n    } else {\n      stylesheetURL = stylesheetURLInfo;\n    }\n    let {favicon = faviconDefault} = options;\n    const {\n      before = beforeDefault,\n      after = afterDefault,\n      canvas = canvasDefault,\n      image = imageDefault\n    } = options;\n    function addLink () {\n      if (before) {\n        before.before(link);\n      } else if (after) {\n        after.after(link);\n      } else {\n        document.head.append(link);\n      }\n    }\n\n    const link = document.createElement('link');\n\n    // eslint-disable-next-line promise/avoid-new -- No native option\n    return new Promise((resolve, reject) => {\n      let rej = reject;\n      if (acceptErrors) {\n        rej = typeof acceptErrors === 'function'\n          ? (error) => {\n            acceptErrors({\n              error, stylesheetURL, options, resolve, reject\n            });\n          }\n          : resolve;\n      }\n      if (stylesheetURL.endsWith('.css')) {\n        favicon = false;\n      } else if (stylesheetURL.endsWith('.ico')) {\n        favicon = true;\n      }\n      if (favicon) {\n        link.rel = 'shortcut icon';\n        link.type = 'image/x-icon';\n\n        if (image === false) {\n          link.href = stylesheetURL;\n          addLink();\n          resolve(link);\n          return;\n        }\n\n        const cnv = document.createElement('canvas');\n        cnv.width = 16;\n        cnv.height = 16;\n        const context = cnv.getContext('2d');\n        const img = document.createElement('img');\n        // eslint-disable-next-line promise/prefer-await-to-callbacks -- No API\n        img.addEventListener('error', (error) => {\n          reject(error);\n        });\n        img.addEventListener('load', () => {\n          if (!context) {\n            throw new Error('Canvas context could not be found');\n          }\n          context.drawImage(img, 0, 0);\n          link.href = canvas\n            ? cnv.toDataURL('image/x-icon')\n            : stylesheetURL;\n          addLink();\n          resolve(link);\n        });\n        img.src = stylesheetURL;\n        return;\n      }\n      link.rel = 'stylesheet';\n      link.type = 'text/css';\n      link.href = stylesheetURL;\n      addLink();\n      // eslint-disable-next-line promise/prefer-await-to-callbacks -- No API\n      link.addEventListener('error', (error) => {\n        rej(error);\n      });\n      link.addEventListener('load', () => {\n        resolve(link);\n      });\n    });\n  }\n\n  return Promise.all(\n    stylesheets.map((stylesheetURL) => setupLink(stylesheetURL))\n  );\n}\n"],"names":["stylesheets","_ref","arguments","length","undefined","beforeDefault","before","afterDefault","after","faviconDefault","favicon","canvasDefault","canvas","_ref$image","image","imageDefault","acceptErrors","Array","isArray","Promise","all","map","stylesheetURL","stylesheetURLInfo","options","_stylesheetURLInfo","_slicedToArray","_stylesheetURLInfo$","_options$favicon","_options2","_options2$before","_options2$after","_options2$canvas","_options2$image","addLink","link","document","head","append","createElement","resolve","reject","rej","error","endsWith","rel","type","href","cnv","width","height","context","getContext","img","addEventListener","Error","drawImage","toDataURL","src","setupLink"],"mappings":"ytCAgCe,SAA0BA,GAIjC,IAAAC,EAAAC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAJ,CAAA,EAHMG,EAAaJ,EAArBK,OAA8BC,EAAYN,EAAnBO,MAA8BC,EAAcR,EAAvBS,QACpCC,EAAaV,EAArBW,OAAMC,EAAAZ,EAAiBa,MAAOC,OAAY,IAAAF,GAAOA,EACjDG,EAAYf,EAAZe,aAuGA,OArGAhB,EAAciB,MAAMC,QAAQlB,GAAeA,EAAc,CAACA,GAqGnDmB,QAAQC,IACbpB,EAAYqB,IAAI,SAACC,GAAa,OAhGhC,SAAoBC,GAElB,IAGID,EAHAE,EAAU,CAAA,EAId,GAAIP,MAAMC,QAAQK,GAAoB,CAAA,IAAAE,EAAAC,EACHH,EAAiB,GAAhDD,EAAaG,EAAA,GAAA,IAAAE,EAAAF,EAAA,GAAED,OAAO,IAAAG,EAAG,CAAA,EAAEA,CAC/B,MACEL,EAAgBC,EAElB,IAAwCK,EAAPJ,EAA5Bd,QAAAA,OAAO,IAAAkB,EAAGnB,EAAcmB,EAC7BC,EAKIL,EAAOM,EAAAD,EAJTvB,OAAAA,OAAM,IAAAwB,EAAGzB,EAAayB,EAAAC,EAAAF,EACtBrB,MAAAA,OAAK,IAAAuB,EAAGxB,EAAYwB,EAAAC,EAAAH,EACpBjB,OAAAA,OAAM,IAAAoB,EAAGrB,EAAaqB,EAAAC,EAAAJ,EACtBf,MAAAA,OAAK,IAAAmB,EAAGlB,EAAYkB,EAEtB,SAASC,IACH5B,EACFA,EAAOA,OAAO6B,GACL3B,EACTA,EAAMA,MAAM2B,GAEZC,SAASC,KAAKC,OAAOH,EAEzB,CAEA,IAAMA,EAAOC,SAASG,cAAc,QAGpC,OAAO,IAAIpB,QAAQ,SAACqB,EAASC,GAC3B,IAAIC,EAAMD,EAeV,GAdIzB,IACF0B,EAA8B,mBAAjB1B,EACT,SAAC2B,GACD3B,EAAa,CACX2B,MAAAA,EAAOrB,cAAAA,EAAeE,QAAAA,EAASgB,QAAAA,EAASC,OAAAA,GAE5C,EACED,GAEFlB,EAAcsB,SAAS,QACzBlC,GAAU,EACDY,EAAcsB,SAAS,UAChClC,GAAU,GAERA,EAAS,CAIX,GAHAyB,EAAKU,IAAM,gBACXV,EAAKW,KAAO,gBAEE,IAAVhC,EAIF,OAHAqB,EAAKY,KAAOzB,EACZY,SACAM,EAAQL,GAIV,IAAMa,EAAMZ,SAASG,cAAc,UACnCS,EAAIC,MAAQ,GACZD,EAAIE,OAAS,GACb,IAAMC,EAAUH,EAAII,WAAW,MACzBC,EAAMjB,SAASG,cAAc,OAiBnC,OAfAc,EAAIC,iBAAiB,QAAS,SAACX,GAC7BF,EAAOE,EACT,GACAU,EAAIC,iBAAiB,OAAQ,WAC3B,IAAKH,EACH,MAAM,IAAII,MAAM,qCAElBJ,EAAQK,UAAUH,EAAK,EAAG,GAC1BlB,EAAKY,KAAOnC,EACRoC,EAAIS,UAAU,gBACdnC,EACJY,IACAM,EAAQL,EACV,QACAkB,EAAIK,IAAMpC,EAEZ,CACAa,EAAKU,IAAM,aACXV,EAAKW,KAAO,WACZX,EAAKY,KAAOzB,EACZY,IAEAC,EAAKmB,iBAAiB,QAAS,SAACX,GAC9BD,EAAIC,EACN,GACAR,EAAKmB,iBAAiB,OAAQ,WAC5Bd,EAAQL,EACV,EACF,EACF,CAGqCwB,CAAUrC,EAAc,GAE/D"}